<!-- You can open the modal using ID.showModal() method -->
<button class="btn" onclick="my_modal_4.showModal()">open modal</button>
<dialog id="my_modal_4" class="modal">
  <div class="modal-box w-11/12 max-w-5xl">
    <!-- Modal Content Body ONLY -->
    <div class="w-full md:w-[460px] bg-white relative rounded-xl p-7 shadow-xl mx-auto">
      <!-- Header (العنوان + زر أعلى يمين) -->
      <div class="flex items-center justify-between mb-5">
        <div class="text-lg font-bold text-gray-800">
          @if (modalStep() === 1) { Select Address } @else { Add New Address }
        </div>
        @if (modalStep() === 1) {
          <button (click)="goToForm()" class="bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition flex items-center gap-2">
            <i class="fas fa-plus"></i> New Address
          </button>
        }
        @if (modalStep() === 2) {
          <button (click)="backToList()" class="text-pink-600 bg-pink-100 hover:bg-pink-200 rounded-lg px-3 py-2 flex items-center gap-1 transition text-sm">
            <i class="fas fa-arrow-left"></i> Back
          </button>
        }
      </div>
     
      <!-- Step 1: List Addresses or Empty Message -->
      @if (modalStep() === 1) {
        @if (totalUserAddresses()?.length) {
         <div class="flex flex-col gap-4 max-h-72 overflow-auto">
  @for (address of totalUserAddresses(); track address._id) {
   <div class="rounded-xl bg-gray-50 p-4 flex items-center border border-gray-300 shadow-sm transition hover:shadow-lg hover:border-pink-400">
  <!-- User Icon -->
  <div class="flex items-center justify-center w-12 h-12 rounded-full bg-gray-200 mr-4">
    <i class="fas fa-user text-gray-500 text-2xl"></i>
  </div>
  <div class="flex-1">
    <div class="font-bold text-base mb-1 text-gray-800 flex items-center gap-2">
      {{ address.username }}
    </div>
    <div class="text-sm mb-1 text-gray-600 flex items-center gap-2">
      <i class="fas fa-city text-pink-400"></i>
      {{ address.city }}
    </div>
    <div class="text-sm mb-1 text-gray-600 flex items-center gap-2">
      <i class="fas fa-road text-pink-400"></i>
      {{ address.street }}
    </div>
    <div class="flex items-center gap-2 text-sm text-gray-500">
      <i class="fas fa-phone-alt text-pink-400"></i>
      <span>{{ address.phone }}</span>
    </div>
  </div>
  <!-- Remove Icon Button -->
  <button (click)="removeAddress(address._id)" class="ml-4 bg-gray-100 hover:bg-pink-100 text-pink-600 rounded-full p-2 transition shadow">
    <i class="fas fa-trash-alt"></i>
  </button>
</div>
  }
</div>
        } @else {
          <div class="flex flex-col items-center py-12">
            <i class="fas fa-map-marker-alt text-5xl text-pink-300 mb-3"></i>
            <div class="font-bold text-lg text-pink-700 mb-2">No Addresses Found!</div>
            <div class="text-gray-400 mb-3 text-sm">Add your first shipping address now.</div>
          </div>
        }
      }

      <!-- Step 2: Add New Address Form -->
      @if (modalStep() === 2) {
        <form [formGroup]="addressForm" (ngSubmit)="submitForm()" class="flex flex-col gap-6" autocomplete="off" spellcheck="false">
          <!-- Name -->
          <div>
            <label for="username" class="block mb-2 text-sm font-medium text-gray-700">Name</label>
            <input
              formControlName="username" 
              type="text" 
              id="username"
              autocomplete="off" 
              autocorrect="off" 
              autocapitalize="off"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-pink-500 focus:border-pink-500 block w-full p-2.5 transition shadow-sm"
              placeholder="Full Name" 
              required />
          </div>

          <!-- City -->
          <div>
            <label for="city" class="block mb-2 text-sm font-medium text-gray-700">City</label>
            <input 
              id="city" 
              formControlName="city" 
              type="text"
              autocomplete="off" 
              autocorrect="off"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-pink-500 focus:border-pink-500 block w-full p-2.5 transition shadow-sm"
              placeholder="Enter city" 
              required>
          </div>

          <!-- Address -->
          <div>
            <label for="street" class="block mb-2 text-sm font-medium text-gray-700">Address</label>
            <input 
              id="street" 
              formControlName="street" 
              type="text"
              autocomplete="off" 
              autocorrect="off"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-pink-500 focus:border-pink-500 block w-full p-2.5 transition shadow-sm"
              placeholder="Full Address" 
              required>
          </div>

          <!-- Phone -->
          <div>
            <label for="phone" class="block mb-2 text-sm font-medium text-gray-700">Phone</label>
            <input 
              id="phone" 
              formControlName="phone" 
              type="tel"
              autocomplete="off" 
              autocorrect="off"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-pink-500 focus:border-pink-500 block w-full p-2.5 transition shadow-sm"
              placeholder="01XXXXXXXXX" 
              required>
          </div>
          
          <div id="map" style="height: 400px; width: 100%; background: #f0f0f0;"></div>
          
          <!-- الأزرار -->
          <div class="flex gap-4 pt-2">
            <button 
              type="button" 
              (click)="backToList()"  
              class="bg-gray-100 text-pink-500 border border-pink-200 px-5 py-2 rounded-lg font-medium hover:bg-gray-200 transition flex items-center gap-2">
              <i class="fas fa-arrow-left"></i> Back
            </button>
            <button 
              type="submit"  
              [disabled]="addressForm.invalid || isSubmitting"
              class="bg-pink-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-pink-700 transition flex items-center gap-2 ml-auto shadow-md disabled:opacity-50">
              <i class="fas fa-plus"></i> 
              {{ isSubmitting ? 'Saving...' : 'Save Address' }}
            </button>
          </div>
        </form>
      } 
    </div>
   
    <div class="modal-action">
      <form method="dialog">
        <!-- if there is a button, it will close the modal -->
        <button class="btn">Close</button>
      </form>
    </div>
  </div>
</dialog>
